<h1>トップページ</h1>
ログイン後この画面に遷移
<h2><%= current_user.name %>さん、どこへ行きますか？</h2>


<p>あなたの現在地</p>
<script>
if( navigator.geolocation ){　// 現在位置を取得できる場合の処理
// 現在位置を取得する
navigator.geolocation.getCurrentPosition( success, error, option);
/*現在位置が取得できた時に実行*/
function success(position){
var data = position.coords ;
// 必要な緯度経度だけ取得
var lat = data.latitude;
var lng = data.longitude;
//Google Maps
var geocoder = new google.maps.Geocoder();
latlng = new google.maps.LatLng(lat, lng);
geocoder.geocode({'latLng': latlng}, function(results, status) {
if (status == google.maps.GeocoderStatus.OK) {
map.setCenter(latlng);
var marker = new google.maps.Marker({
map: map,
position: latlng
});
google.maps.event.addListener(marker, 'click', function (e) {
infowindow.setContent(results[0].formatted_address);
infowindow.open(map, marker);
});
document.getElementById('address').innerHTML = results[0].formatted_address;
}
else {
alert("エラー" + status);
}
});
}
/*現在位置の取得に失敗した時に実行する関数名*/
function error(error){
var errorMessage = {
0: "原因不明のエラーが発生しました。",
1: "位置情報が許可されませんでした。",
2: "位置情報が取得できませんでした。",
3: "タイムアウトしました。",
} ;
//とりあえずalert
alert( errorMessage[error.code]);
}
// オプション(省略可)
var option = {
"enableHighAccuracy": false,
"timeout": 100 ,
"maximumAge": 100 ,
};
//MAPの表示
var map;
function initMap() {
map = new google.maps.Map(document.getElementById('sample'), {
zoom: 15
});
}
} else {// 現在位置を取得できない場合の処理
//とりあえずalert
alert("あなたの端末では、現在位置を取得できません。");
}
</script>
<div id="sample" style="width: 700px; height: 400px;"></div>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_API_KEY'] %>&callback=initMap"></script>

